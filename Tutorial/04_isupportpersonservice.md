# Chapter 4: ISupportPersonService

In the previous chapter, [ISupportService](03_isupportservice.md), we learned how to interact with Support Cases. This chapter introduces `ISupportPersonService`, which focuses on managing the Support Persons themselves. It's like the HR department for our support team, providing tools to manage their profiles and skills.

## What Problem Does ISupportPersonService Solve?

Imagine you need to find a Support Person who specializes in "Networking" to handle a complex network issue.  How do you find the right person?  `ISupportPersonService` provides methods to search for Support Persons based on their skills, availability, and other criteria.  It acts as a directory, helping us quickly find the best person for the job.

## Understanding ISupportPersonService

`ISupportPersonService` (found in `src\ContosoAdsSupport\ContosoSupport\Services\ISupportPersonService.cs`) defines a set of methods for interacting with Support Person data.  It's like a contract that different implementations (e.g., Cosmos DB, in-memory) must follow.

Here's a simplified look:

```csharp
public interface ISupportPersonService
{
    Task<SupportPerson?> GetAsync(string alias); // Get a support person by their alias
    Task<IEnumerable<SupportPerson>> GetAsync(string? specialization = null, /* ... other filters */); // Get support persons based on criteria
    // ... other methods for creating, updating, and deleting support persons
}
```

Let's focus on the `GetAsync` methods:

- `GetAsync(string alias)`: Retrieves a specific Support Person by their unique alias (username).
- `GetAsync(string? specialization = null, /* ... */)`:  Retrieves a list of Support Persons based on various criteria, such as their specialization.

## Using ISupportPersonService

Let's revisit our example of finding a "Networking" specialist. Here's how we'd use `ISupportPersonService`:

```csharp
// ... assuming supportPersonService is an instance of a class that implements ISupportPersonService

var networkingExperts = await supportPersonService.GetAsync(specialization: "Networking");

// networkingExperts now contains a list of SupportPerson objects who specialize in "Networking"
```

This code uses the `GetAsync` method with the `specialization` filter to retrieve all Support Persons who have "Networking" listed in their skills.

## Internal Implementation

When `GetAsync` is called, the `SupportPersonsController` (found in `src\ContosoAdsSupport\ContosoSupport\Controllers\SupportPersonsController.cs`) interacts with the concrete implementation of `ISupportPersonService`.

Let's visualize this with a sequence diagram:

```mermaid
sequenceDiagram
    participant Client
    participant Controller as SupportPersonsController
    participant Service as ISupportPersonService
    participant Impl as SupportPersonServiceCosmosDb/SupportPersonServiceInMemory
    participant DB as Database/Memory

    Client->>Controller: Get Networking experts (GET request)
    activate Controller
    Controller->>Service: GetAsync(specialization: "Networking")
    activate Service
    Service->>Impl: Find SupportPersons with "Networking" specialization
    activate Impl
    Impl->>DB: Query for matching SupportPersons
    deactivate DB
    Impl-->>Service: List of SupportPersons
    deactivate Impl
    Service-->>Controller: List of SupportPersons
    deactivate Service
    Controller-->>Client: List of Networking experts (HTTP 200 OK)
    deactivate Controller
```


Here's a simplified snippet from `SupportPersonServiceCosmosDb` (found in `src\ContosoAdsSupport\ContosoSupport\Services\SupportPersonServiceCosmosDb.cs`) showing a simplified implementation of the filtering logic within `GetAsync`:

```csharp
// ... other code ...

// Filter by specialization
if (!string.IsNullOrEmpty(specialization))
{
    filters.Add(filterBuilder.AnyEq(x => x.Specializations, specialization));
}

// ... other code to build the query and execute it against the database ...
```

This code adds a filter to the database query, ensuring that only Support Persons with the specified `specialization` are returned.

## Conclusion

We've learned that `ISupportPersonService` provides a consistent way to interact with Support Person data. This abstraction simplifies finding the right expert for a given [Support Case](01_support_case.md).  In the next chapter, [Assignment Logic/Validator](05_assignment_logic_validator.md), we'll explore how the system assigns Support Cases to Support Persons.


---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)